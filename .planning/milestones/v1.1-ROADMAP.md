# Milestone v1.1: AI Intelligence & Multi-Action

**Status:** ✅ SHIPPED 2026-02-09
**Phases:** 4-7
**Total Plans:** 8

## Overview

Make the AI smarter — multi-action output, image understanding, user learning, routine inference, and interactive confirmation flows. Four phases building progressively: multi-action foundation enables batch operations, user learning adds personalization, image intelligence adds multimodal understanding, and routine intelligence infers scheduling patterns from existing data.

## Phases

### Phase 4: Multi-Action Foundation
**Goal**: AI can execute multiple actions per prompt with safe partial failure handling
**Depends on**: Nothing (first v1.1 phase)
**Requirements**: MACT-01, MACT-02, MACT-03, MACT-04, MACT-05
**Plans**: 2 plans

Plans:
- [x] 04-01-PLAN.md — Multi-action chat pipeline (domain models, handler refactor, prompt update, chat tests)
- [x] 04-02-PLAN.md — Bulk endpoints (POST/DELETE /api/habits/bulk with partial success, endpoint tests)

### Phase 5: User Learning System
**Goal**: AI learns and personalizes based on user facts extracted from conversations
**Depends on**: Phase 4
**Requirements**: ULRN-01, ULRN-02, ULRN-03, ULRN-04
**Plans**: 2 plans

Plans:
- [x] 05-01-PLAN.md — UserFact entity, extraction service, and chat pipeline integration (ULRN-01, ULRN-02)
- [x] 05-02-PLAN.md — UserFacts API endpoints and integration tests (ULRN-03, ULRN-04)

### Phase 6: Image Intelligence
**Goal**: AI can analyze uploaded images and suggest habit creation from visual content
**Depends on**: Phase 4 (needs confirmation flow)
**Requirements**: IMGP-01, IMGP-02, IMGP-03, IMGP-04
**Plans**: 2 plans

Plans:
- [x] 06-01-PLAN.md — Image upload infrastructure (validation, multipart binding, Gemini Vision integration)
- [x] 06-02-PLAN.md — Image-aware AI prompting and integration tests

### Phase 7: Routine Intelligence
**Goal**: AI detects user logging patterns and suggests optimal scheduling with conflict detection
**Depends on**: Phase 5 (can store patterns as facts)
**Requirements**: RTNI-01, RTNI-02, RTNI-03, RTNI-04
**Plans**: 2 plans

Plans:
- [x] 07-01-PLAN.md — Routine analysis service (domain models, IRoutineAnalysisService, GeminiRoutineAnalysisService, SystemPromptBuilder routine context, DI wiring)
- [x] 07-02-PLAN.md — Chat pipeline integration and tests (conflict warnings on CreateHabit, routine patterns in AI context, 4 integration tests)

---

## Milestone Summary

**Key Decisions:**
- ActionResult with ActionStatus enum for per-action responses (04-01)
- SuggestBreakdown as suggestion-only action requiring confirmation (04-01)
- Bulk operations use keep-successes partial failure policy (04-02)
- Fact extraction always uses Gemini for JSON reliability (05-01)
- Fact extraction is non-critical with graceful degradation (05-01)
- Soft delete for UserFacts with global query filter (05-01)
- IFormFile in Domain layer as pragmatic tradeoff (06-01)
- Multipart form-data over separate endpoints (06-01)
- Base64 inline_data over File API for Gemini Vision (06-01)
- Ollama image support deferred (06-01)
- LLM-first pattern analysis over statistical methods (07-01)
- Always use Gemini for routine analysis (07-01)
- Non-critical routine analysis in chat pipeline (07-02)
- Conflict warnings are post-creation informational (07-02)

**Issues Resolved:**
- Multi-action partial failure handling with per-action error reporting
- Image validation with magic byte verification preventing file extension spoofing
- UTC-to-local timezone conversion for accurate routine pattern detection

**Issues Deferred:**
- Ollama image/vision support (Ollama doesn't support multimodal APIs)
- Fact deduplication (same fact can be extracted multiple times)
- Category validation for UserFacts (accepts any string)

**Technical Debt Incurred:**
- IFormFile reference in Domain project (Microsoft.AspNetCore.Http.Features dependency)
- Microsoft.EntityFrameworkCore in Application project (pre-existing from v1.0)
- Ollama reliability uncertain with expanded AI prompts

---

_For current project status, see .planning/ROADMAP.md_

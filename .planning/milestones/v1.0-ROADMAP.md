# Milestone v1.0: Backend Solidification

**Status:** SHIPPED 2026-02-08
**Phases:** 1-3
**Total Plans:** 8

## Overview

Orbit's backend solidification milestone transforms the existing MVP into a full habit tracking platform. Starting with infrastructure modernization (migrations, validation, library upgrades, task removal), then extending the domain model with sub-habits, negative habits, tags, and user timezone, and finishing with progress metrics and AI enhancement. Three phases, each delivering a coherent capability that unblocks the next.

## Phases

### Phase 1: Infrastructure Foundation
**Goal**: The codebase is modernized with proper schema management, input validation, updated libraries, and task management removed
**Depends on**: Nothing (first phase)
**Requirements**: INFRA-01, INFRA-02, INFRA-03, INFRA-04, CLEAN-01
**Success Criteria** (what must be TRUE):
  1. Database schema changes are managed through EF Core migrations (EnsureCreated is gone)
  2. API requests with invalid input return structured validation errors before reaching command/query handlers
  3. API documentation is browsable via Scalar UI at /scalar/v1
  4. JWT authentication works with the updated Microsoft.IdentityModel.JsonWebTokens library
  5. All task management code (entities, commands, queries, controllers, tests) is removed from the codebase
**Plans:** 3 plans

Plans:
- [x] 01-01-PLAN.md -- Migrations baseline + OpenAPI/Scalar swap + JWT upgrade (Wave 1)
- [x] 01-02-PLAN.md -- FluentValidation pipeline + validators (Wave 2)
- [x] 01-03-PLAN.md -- Task removal across all layers + RemoveTaskItems migration (Wave 2)

### Phase 2: Habit Domain Extensions
**Goal**: Users can manage sub-habits, negative habits, tags, notes, and their timezone -- the complete habit model
**Depends on**: Phase 1 (migrations must exist before schema changes)
**Requirements**: HABIT-01, HABIT-02, HABIT-03, HABIT-04, HABIT-05, TAG-01, TAG-02, TAG-03, PROF-01
**Success Criteria** (what must be TRUE):
  1. User can create a parent habit with child sub-habits and log each sub-habit individually
  2. User can create a negative habit and see "days since last slip" after logging slip-ups
  3. User can add a text note when logging any habit
  4. User can create tags with name and color, assign them to habits, and filter habits by tag
  5. User can set their timezone for correct date-based calculations
**Plans:** 3 plans

Plans:
- [x] 02-01-PLAN.md -- Domain entities, DbContext config, repository includes, and migration (Wave 1)
- [x] 02-02-PLAN.md -- Habit extensions: sub-habits, negative habits, notes, AI prompt update (Wave 2)
- [x] 02-03-PLAN.md -- Tags CRUD + assignment + filtering, profile/timezone (Wave 2)

### Phase 3: Metrics and AI Enhancement
**Goal**: Users can see progress metrics for their habits and the AI handles expanded capabilities correctly
**Depends on**: Phase 2 (metrics need domain model, AI needs new features to expose)
**Requirements**: METR-01, METR-02, METR-03, AI-01, AI-02, AI-03
**Success Criteria** (what must be TRUE):
  1. User can see current streak and longest streak for any habit (frequency-aware, timezone-aware)
  2. User can see weekly and monthly completion rates for any habit
  3. User can see progress trends over time for quantifiable habits
  4. AI gracefully refuses out-of-scope requests with helpful messages instead of attempting invalid actions
  5. AI can create sub-habits and suggest/assign tags when creating habits via chat
**Plans:** 2 plans

Plans:
- [x] 03-01-PLAN.md -- Habit metrics: frequency-aware streaks, completion rates, and quantifiable trends (Wave 1)
- [x] 03-02-PLAN.md -- AI enhancement: sub-habit creation, tag suggestion/assignment, refined refusal (Wave 1)

---

## Milestone Summary

**Key Decisions:**
- EF Core migrations gate all schema changes -- must be Phase 1
- Tags use Tag entity + HabitTag join table (not text[] array) for color metadata support
- Compressed 5 researched phases into 3 for quick depth
- SubHabit is a separate entity (not self-referencing Habit) for simplicity
- HabitTag uses composite key (HabitId, TagId), does not extend Entity base
- Negative boolean habits allow multiple logs per day (slip-up tracking)
- User.TimeZone validated via TimeZoneInfo.FindSystemTimeZoneById for cross-platform IANA support
- Added Microsoft.EntityFrameworkCore to Application project for Include support (pragmatic tradeoff)
- FindOneTrackedAsync pattern for tracked entity loading with navigation properties
- Tag assignment via EF navigation property manipulation (habit.Tags.Add/Remove)
- AI sub-habit creation supports both inline (CreateHabit with SubHabits) and separate (CreateSubHabit action)
- Tag suggestions are informational only in aiMessage -- assignment requires existing tag IDs

**Issues Resolved:**
- EnsureCreated-to-migrations transition completed successfully (baseline migration applied)
- OpenAPI.NET 2.0 API compatibility for .NET 10 (v1 Reference pattern broken)
- FluentValidation.AspNetCore deprecated -- used FluentValidation.DependencyInjectionExtensions instead

**Issues Deferred:**
- Ollama reliability with expanded AI prompts uncertain -- may need Gemini-only for some features
- Pre-existing MSB3277 warning in IntegrationTests (EF Core Relational version conflict) -- cosmetic

**Technical Debt Incurred:**
- Microsoft.EntityFrameworkCore reference in Application project (pragmatic but breaks strict clean architecture)
- No database indexes explicitly added for metrics queries (relies on existing indexes)

---

_For current project status, see .planning/ROADMAP.md_
